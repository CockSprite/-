<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>농작물재해보험 계약 현황 검색</title>
</head>
<body>
    <h1>농작물재해보험 계약 현황 검색</h1>

    <form id="searchForm">
        <!-- 작물 종류 선택: 필수 -->
        <label for="crop_type">작물 종류 선택:</label>
        <select name="crop_type" id="crop_type" required>
            <option value="paddy1">Paddy Crop 1</option>
            <option value="paddy2">Paddy Crop 2</option>
            <option value="special">Special Crops</option>
            <option value="fruit">Fruit Crops</option>
            <option value="field">Field Crops</option>
        </select>

        <!-- 필수 조건: 품목명, 품종명 입력 -->
        <label for="query">품목명, 품종명 (필수):</label>
        <input type="text" name="query" id="query" placeholder="예: 벼, 흑미" required>

        <!-- 선택 조건 입력란: 특용작물일 경우 보험가입면적만, 나머지 작물은 모두 선택 가능 -->
        <div id="optionalFields">
            <label for="std_yield">표준수확량 (선택):</label>
            <input type="number" name="std_yield" id="std_yield" placeholder="표준수확량">

            <label for="avg_yield">평년수확량 (선택):</label>
            <input type="number" name="avg_yield" id="avg_yield" placeholder="평년수확량">

            <label for="ins_yield">가입수확량 (선택):</label>
            <input type="number" name="ins_yield" id="ins_yield" placeholder="가입수확량">

            <label for="ins_area">보험가입면적 (선택):</label>
            <input type="number" name="ins_area" id="ins_area" placeholder="보험가입면적">
        </div>

        <button type="submit">검색</button>
    </form>

    <!-- 결과 표시 -->
    <div id="results"></div>

    <script>
        // 폼 제출 이벤트 핸들링
        const form = document.getElementById('searchForm');
        const optionalFields = document.getElementById('optionalFields');
        const cropType = document.getElementById('crop_type');

        // 특용작물 선택 시 보험가입면적만 활성화, 나머지 작물 선택 시 모든 선택 조건 활성화
        cropType.addEventListener('change', function() {
            if (cropType.value === 'special') {
                // 특용작물: 보험가입면적만 입력 가능
                document.getElementById('std_yield').disabled = true;
                document.getElementById('avg_yield').disabled = true;
                document.getElementById('ins_yield').disabled = true;
                document.getElementById('ins_area').disabled = false;
            } else {
                // 나머지 작물: 모든 필드 입력 가능
                document.getElementById('std_yield').disabled = false;
                document.getElementById('avg_yield').disabled = false;
                document.getElementById('ins_yield').disabled = false;
                document.getElementById('ins_area').disabled = false;
            }
        });

        form.addEventListener('submit', function(e) {
            e.preventDefault();
            const query = document.getElementById('query').value;
            const cropType = document.getElementById('crop_type').value;
            const std_yield = document.getElementById('std_yield').value;
            const avg_yield = document.getElementById('avg_yield').value;
            const ins_yield = document.getElementById('ins_yield').value;
            const ins_area = document.getElementById('ins_area').value;

            // 검색 URL에 선택 옵션 추가
            const url = `/search?query=${query}&crop_type=${cropType}&std_yield=${std_yield}&avg_yield=${avg_yield}&ins_yield=${ins_yield}&ins_area=${ins_area}`;
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    const resultDiv = document.getElementById('results');
                    resultDiv.innerHTML = '';
                    if (data.length === 0) {
                        resultDiv.textContent = '검색 결과가 없습니다.';
                    } else {
                        const table = document.createElement('table');
                        const headerRow = document.createElement('tr');
                        headerRow.innerHTML = `<th>표준수확량(kg)</th><th>평년수확량(kg)</th><th>가입수확량(kg)</th><th>보험가입면적(㎡)</th>`;
                        table.appendChild(headerRow);

                        data.forEach(item => {
                            const row = document.createElement('tr');
                            row.innerHTML = `<td>${item['표준수확량(kg)'] || ''}</td>
                                             <td>${item['평년수확량(kg)'] || ''}</td>
                                             <td>${item['가입수확량(kg)'] || ''}</td>
                                             <td>${item['보험가입면적(㎡)'] || ''}</td>`;
                            table.appendChild(row);
                        });

                        resultDiv.appendChild(table);
                    }
                });
        });
    </script>
</body>
</html>

